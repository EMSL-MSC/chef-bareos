<%# STORAGE DAEMON TEMPLATE %>
# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.
#
# Bareos Storage Daemon Configuration File#

Storage {
  Name = <%= node['fqdn'] %>-sd
  SDPort = <%= node['bareos']['storage']['sd_port'] %>
  Maximum Concurrent Jobs = <%= node['bareos']['storage']['max_concurrent_jobs'] %>
}

<% @bareos_dir.each do |director| %>
##########
# Director/Monitor Resources for <%= director %> #
##########
Director {
  Name = <%= director['fqdn'] %>-dir
  Password = "<%= node['bareos']['sd_password'] %>"
}

Director {
  Name = <%= director['fqdn'] %>-mon
  Password = "<%= director['bareos']['mon_password'] %>"
  Monitor = <%= node['bareos']['storage']['sd_mon_enable'] %>
}

Messages {
  Name = <%= node['bareos']['messages']['default_messages'] %>
  director = <%= director['fqdn'] %>-dir = all
}
##########

<% end %>

Device {  
  Name = FileStorage  
  Media Type = File  
  Archive Device = /var/lib/bareos/storage
  Random Access = Yes;  
  AutomaticMount = yes;  
  RemovableMedia = no;  
  AlwaysOpen = no;  
  LabelMedia = yes  
}
<% if node['bareos']['storage']['custom_configs'] == '1' %>

########################################
# Custom Storage Daemon Config Locations
########################################

@|"sh -c 'for f in /etc/bareos/bareos-sd.d/*.conf ; do echo @${f} ; done'"
<% end %>
